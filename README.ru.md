На других языках: [English](README.en.md)

# Puny Switcher #

Скрипт для исправления текста, набранного не в той раскладке, и безусловного переключения раскладок в X11 и GNOME.

## Возможности ##

- Безусловное переключение раскладки: каждому языку свой хоткей
- Исправление последнего слова / всей строки до курсора / выделенного текста
- Буфер обмена сохраняется
- Нет кейлоггинга
- Нет имитации клавиатурного ввода
- Нет мониторинга клавиатуры
- Нет ремаппинга клавиш
- Есть альтернативные версии функций для cистем без GNOME и systemd

## Установка ##

- Установить [расширение для GNOME](https://extensions.gnome.org/extension/6691/shyriiwook) для безусловного переключения раскладки консольной командой ([репозиторий](https://github.com/madhead/shyriiwook)).
- Установить [xsel](http://www.kfish.org/software/xsel/) для манипуляций буфером обмена и выделением ([репозиторий](https://github.com/kfish/xsel)).
- Уcтановить [kanata](https://github.com/jtroo/kanata/) (а именно — версию [`kanata_cmd_allowed`](https://github.com/jtroo/kanata/releases/latest), позволяющую исполнять внешние команды) или любой другой ремаппер клавиатуры, умеющий макросы и вызов внешних команд.
- Разрешить kanata доступ к системе ввода, как описано [здесь](https://github.com/jtroo/kanata/blob/main/docs/setup-linux.md).
- Сохранить [скрипт](./puny-switcher.sh) в `~/.local/bin`.
- Изучить его содержимое, по необходимости отредактировав.
- Разрешить его исполнение:
```
chmod +x ~/.local/bin/puny-switcher.sh
```
- Сохранить [конфиг](./kanata/puny-switcher.kbd) для kanata в `$XDG_CONFIG_HOME/kanata/` (обычно это `~/.config/kanata/`).
- Изучить его содержимое, по необходимости отредактировав.
- Сохранить [systemd-конфиг](./kanata/kanata@.service) для автозапуска kanata в `$XDG_CONFIG_HOME/systemd/user/` (обычно это `~/.config/systemd/user/`).
- Запустить сервис:
```
systemctl --user daemon-reload
systemctl --user enable --now kanata@puny-switcher.service
```
- В скрипте также используются команды `busctl` (входит в systemd), `sed`, `grep`, `bash`.

## Настройка ##

TODO

## Недостатки ##

- Зависит от стороннего ПО
- Не работает в эмуляторах терминала
- Пока умеет переключаться только между английским и русским языками
- Не учитывает варианты раскладок (Дворак, машинопись и т.д.)
- Не проверялось на системах без GNOME и systemd

## Важное ##

[Queer Svit](https://queersvit.org/) — независимая команда волонтёров со всего мира. С вашей поддержкой мы помогаем ЛГБТК+ сообществу и небелым* людям из Украины, России, Беларуси и других стран региона ВЕЦА. Мы помогаем людям, пострадавшим от войны и/или политических репрессий, оказываем поддержку при переезде — проводим консультации, приобретаем билеты, находим бесплатное жильё и предоставляем гуманитарную помощь.

Война, как и всякая катастрофа, сильнее всего бьет по наиболее уязвимым членам общества. Так, маргинализированные группы (включая ЛГБТК+ и небелых* людей) находятся в большей опасности, но об их проблемах почти общество почти не слышит. Но так как наша команда и состоит из квир- и небелых* людей, мы не понаслышке знаем о трудностях, с которыми сталкиваются наши бенефициары, и хорошо понимаем, как им помочь.

Ваши пожертвования имеют значение; Queer Svit существует в значительной степени за счет небольших пожертвований индивидуальных жертвователей. Мы благодарны за любую помощь — спасибо!

## Лицензия ##

[Hippocratic License 3.0 (HL3-CORE)](https://github.com/roadkell/puny-switcher/blob/main/LICENSE.md)
